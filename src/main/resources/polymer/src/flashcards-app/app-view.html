<link rel="import" href="../../bower_components/polymer/polymer-element.html">
<link rel="import" href="../../bower_components/iron-pages/iron-pages.html">
<link rel="import" href="../../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../../bower_components/app-route/app-route.html">
<link rel="import" href="../../bower_components/app-route/app-location.html">
<link rel="import" href="../../bower_components/app-layout/app-toolbar/app-toolbar.html">
<link rel="import" href="../../bower_components/app-layout/app-drawer/app-drawer.html">
<link rel="import" href="../../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../../bower_components/paper-item/paper-item.html">
<link rel="import" href="../../bower_components/paper-dialog/paper-dialog.html">
<link rel="import" href="../../bower_components/paper-dialog-scrollable/paper-dialog-scrollable.html">
<link rel="import" href="../../bower_components/paper-button/paper-button.html">
<link rel="import" href="/src/flashcards-app/index-view.html">
<link rel="import" href="/src/flashcards-app/login-view.html">
<link rel="import" href="/src/flashcards-app/card-view.html">

<dom-module id="app-view">
    <template>
        <style>
          :host {
            display: block;
          }
          #drawer {
            z-index: 100;
          }
          #about {
            width: 426px;
            height: 522px;
          }
          #about-buttons {
            position: absolute;
            bottom: 12px;
            right: 12px;
          }
          paper-button {
            background-color: var(--paper-pink-400);
            color: #ffffff;
          }
          paper-item {
            font-weight: bold;
          }
          paper-menu > paper-item:hover {
            background-color: var(--paper-pink-400);
            color: #ffffff;
            font-weight: bold;
            user-select: none;
            cursor: pointer;
          }
          app-toolbar {
            background-color: var(--paper-pink-400);
            font-family: 'Roboto', Helvetica, sans-serif;
            color: white;
            --app-toolbar-font-size: 24px;
          }
        </style>
        <app-location route="{{route}}"></app-location>

        <app-route
                route="{{route}}"
                pattern="/:view"
                data="{{routeData}}"
                tail="{{subroute}}">
        </app-route>

        <app-toolbar>
            <paper-icon-button icon="menu" on-click="drawer"></paper-icon-button>
            <div main-title>Flashcards</div>
            <paper-icon-button icon="search" on-click="search"></paper-icon-button>
        </app-toolbar>

        <app-drawer id="drawer">
            <paper-menu selected="0">
                <!-- if not logged in then go to login view -->
                <paper-item on-click="login" hidden$="[[authenticated]]">Login</paper-item>

                <paper-item on-click="categories" hidden$="[[!authenticated]]">My Categories</paper-item>
                <paper-item on-click="shared" hidden$="[[!authenticated]]">Friends Categories</paper-item>
                <paper-item on-click="public" hidden$="[[!authenticated]]">Public Categories</paper-item>
                <paper-item on-click="settings" hidden$="[[!authenticated]]">Settings</paper-item>
                <paper-item on-click="account" hidden$="[[!authenticated]]">Account</paper-item>
                <paper-item on-click="logout" hidden$="[[!authenticated]]">Logout</paper-item>

                <paper-item on-click="about">About</paper-item>
            </paper-menu>
        </app-drawer>

        <iron-pages selected="[[routeData.view]]" attr-for-selected="name">
            <index-view name="" route="{{subroute}}"></index-view>
            <login-view name="login" route="{{subroute}}"></login-view>
            <card-view name="cards" route="{{subroute}}"></card-view>
        </iron-pages>

        <paper-dialog id="about">
            <a href="https://github.com/codingchili/flashcards-webapp" target="_blank">
                <img style="position: absolute; top: 0; right: 0; border: 0;"
                     src="https://camo.githubusercontent.com/38ef81f8aca64bb9a64448d0d70f1308ef5341ab/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f6461726b626c75655f3132313632312e706e67" alt="Fork me on GitHub"
                     data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png"></a>

            <h2>About the app</h2>
            <paper-dialog-scrollable>
                A web application for studying with flashcards and to<br> create quizzes.

                Some features of this app is:
                <ul>
                    <li>group flashcards into categories</li>
                    <li>share categories with friends</li>
                    <li>make a category public</li>
                    <li>keep track on users scores per category</li>
                    <li>allow media content on cards</li>
                    <li>select answers to cards from a predefined list</li>
                    <li>hotkeys: Answer, Skip, Delete, Flip, Edit</li>
                </ul>
                This applications builds on the following libraries
                <ul>
                    <li><a href="https://github.com/Polymer/polymer" target="_blank">Polymer 2.0</a></li>
                    <li><a href="https://github.com/eclipse/vert.x" target="_blank">Vertx</a></li>
                    <li><a href="https://github.com/hazelcast/hazelcast" target="_blank">Hazelcast</a></li>
                    <li><a href="https://github.com/elastic/elasticsearch" target="_blank">ElasticSearch</a></li>
                    <li><a href="https://github.com/npgall/cqengine" target="_blank">CQEngine</a></li>
                    <li><a href="https://github.com/mongodb/mongo" target="_blank">MongoDB</a></li>
                </ul>
                Sources for flashcards-webapp and chili-core available on <a href="https://github.com/codingchili/">GitHub</a>.
                Author of the app is Robin Duda &copy;2017
            </paper-dialog-scrollable>
            <div class="buttons" id="about-buttons">
                <paper-button dialog-confirm raised autofocus>Close</paper-button>
            </div>
        </paper-dialog>

        <!-- insert footer -->
    </template>

</dom-module>
<script>
    class AppView extends Polymer.Element {
      static get is() { return 'app-view'; }

      constructor() {
        super();
        this.authenticated = false;

        application.subscribe('authenticated', (token) => {
            this.authenticated = true;
            this.set('route.path', '/');
            application.publish('onSearchPage');
        });
        application.subscribe('logout', () => {
            this.authenticated = false;
        });
      }

      drawer() {
        application.authenticated = false;
        this.$.drawer.open();
      }

      search() {
        if (application.authenticated) {

        } else {
            this.set('route.path', '/')
        }
        application.publish('onSearchPage');
      }

      about() {
        this.$.drawer.close();
        this.$.about.open();
      }

      login() {
        this.set('route.path', '/login');
        this.$.drawer.close();
        application.publish('onLoginPage');
      }

      logout() {
        application.onLogout();
        this.$.drawer.close();
        application.publish('onLoginPage');
      }
    }
    window.customElements.define(AppView.is, AppView);
    </script>
