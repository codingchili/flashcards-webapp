<link rel="import" href="../../bower_components/polymer/polymer-element.html">
<link rel="import" href="../../bower_components/paper-card/paper-card.html">
<link rel="import" href="../../bower_components/iron-icon/iron-icon.html">
<link rel="import" href="../../bower_components/iron-ajax/iron-ajax.html">

<dom-module id="statistics-bar">
    <template>
        <style>
      :host {
        display: block;
      }
      #box {
        height: 324px;
        margin-top: 32px;
        display: flex;
        align-items: center;
        flex-direction: column;
        justify-content: space-around;
      }
      paper-card {
        margin: auto;
        width: 152px;
        height: 64px;
        user-select: none;
        cursor: pointer;
      }
      .header {
        font-size: 14px;
        position: absolute;
        top: 6px;
        left: 4px;
      }
      .value {
        position: absolute;
        left: 8px;
        font-size: 28px;
        margin-top: 28px;
        color: rgba(0,0,0,0.4);
      }
      iron-icon {
        position: absolute;
        top: 4px;
        right: 8px;
      }
        </style>

        <div id="box">
            <template is="dom-repeat" items="{{statistics}}">

                <iron-ajax auto id$="{{item.name}}" url="[[api]]"
                        body='{"target":"[[item.name]]", "route":"size"}'
                        handle-as="json" method="post" last-response="{{item.query}}">
                </iron-ajax>

                <paper-card on-click="clicked" elevation="3">
                    <div class="header">[[item.description]]</div>
                    <div class="value">[[item.query.size]]</div>
                    <iron-icon icon="[[item.icon]]"></iron-icon>
                </paper-card>
            </template>
        </div>

    </template>

    <script>
    /**
     * @customElement
     * @polymer
     */
    class StatisticsBar extends Polymer.Element {
      static get is() { return 'statistics-bar'; }
      constructor() {
        super();
        this.api = application.api();
        this.statistics = [
            {"description":"Registered users", "icon": "account-circle", "name":"accounts"},
            {"description":"Total categories", "icon": "apps", "name":"categories"},
            {"description":"Created cards", "icon": "credit-card", "name":"cards"}
          ];

        setInterval(() => {
            for (let item of this.statistics) {
                this.shadowRoot.querySelector('#' + item.name).generateRequest();
            }
        }, 5000);
      }
      clicked(event) {
        application.publish('searchType', event.model.item);
      }
    }

    window.customElements.define(StatisticsBar.is, StatisticsBar);
    </script>
</dom-module>
